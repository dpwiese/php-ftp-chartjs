<!DOCTYPE html>
<html>
  <head>
    <title>Line Chart</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <style>
      canvas {
        -moz-user-select: none;
        -webkit-user-select: none;
        -ms-user-select: none;
      }
      .grid-container {
        margin-left: auto;
        margin-right: auto;
        max-width: 1200px;
      }
      .inside-article {
        padding: 40px;
      }
      .wp-block-columns {
        display: flex;
      }
      @media (min-width: 782px) {
        .wp-block-column {
          flex-basis: 0;
          flex-grow: 1;
        }
      }
      
    </style>
  </head>

  <body>
    <div class="grid-container">
      <div class="inside-article">
        <p>Below is a sample of the data collected from PEARL so far.</p>
        <div class="wp-block-columns">
          <div class="wp-block-column">
            <div style="width:100%;">
              <canvas id="temperature"></canvas>
            </div>
            <div style="width:100%;">
              <canvas id="windSpeed"></canvas>
            </div>
          </div>
          <div class="wp-block-column">
            <div style="width:100%;">
              <canvas id="humidity"></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      
      async function run() {
        let response = await fetch("https://s3.amazonaws.com/followpearl.mit.edu/out.json");
        if (response.ok) {
          let pearlData = await response.json();

          const pearlDateTime = pearlData.date.map((date, i) => {
            return moment(`${date} ${pearlData.time[i]}`).format("DD-MMMM-YYYY h:mm A");
          });

          const temperatureConfig = {
            type: 'line',
            data: {
              labels: pearlDateTime,
              datasets: [{
                label: 'LPS Air Temperature',
                backgroundColor: 'rgb(218, 59, 33)',
                borderColor: 'rgb(218, 59, 33)',
                data: pearlData.lpsTempC,
                fill: false,
                pointRadius: 0,
              }, {
                label: 'SHT Air Temperature',
                fill: false,
                backgroundColor: 'rgb(52, 119, 206)',
                borderColor: 'rgb(52, 119, 206)',
                data: pearlData.shtTempC,
                pointRadius: 0,
              }, {
                label: 'Water Temperature',
                fill: false,
                backgroundColor: 'rgb(51, 146, 116)',
                borderColor: 'rgb(51, 146, 116)',
                data: pearlData.ds18TempC,
                pointRadius: 0,
              }],
            },
            options: {
              responsive: true,
              title: {
                display: true,
                text: 'Deep Pond Temperature',
              },
              tooltips: {
                mode: 'index',
                intersect: false,
              },
              hover: {
                mode: 'nearest',
                intersect: true,
              },
              scales: {
                xAxes: [{
                  id: 'first-y-axis',
                  display: true,
                  scaleLabel: {
                    display: true,
                    labelString: 'Time',
                  },
                  ticks: {
                    autoSkipPadding: 100,
                    autoSkip: true,
                    minRotation: 0,
                    maxRotation: 0,
                    callback: function(value, index, values) {
                      return value.split(" ")[0];
                    }
                  },
                }],
                yAxes: [{
                  display: true,
                  scaleLabel: {
                    display: true,
                    labelString: 'Temperature (deg C)',
                  },
                }]
              }
            }
          };

          const humidityConfig = {
            type: 'line',
            data: {
              labels: pearlDateTime,
              datasets: [{
                label: 'Relative Humidity',
                backgroundColor: 'rgb(224, 110, 60)',
                borderColor: 'rgb(224, 110, 60)',
                data: pearlData.shtHumidPercent,
                fill: false,
                pointRadius: 0,
              }]
            },
            options: {
              responsive: true,
              title: {
                display: true,
                text: 'Deep Pond Relative Humidity',
              },
              tooltips: {
                mode: 'index',
                intersect: false,
              },
              hover: {
                mode: 'nearest',
                intersect: true,
              },
              scales: {
                xAxes: [{
                  display: true,
                  scaleLabel: {
                    display: true,
                    labelString: 'Time'
                  },
                  ticks: {
                    autoSkipPadding: 100,
                    autoSkip: true,
                    minRotation: 0,
                    maxRotation: 0,
                    callback: function(value, index, values) {
                      return value.split(" ")[0];
                    }
                  },
                }],
                yAxes: [{
                  display: true,
                  scaleLabel: {
                    display: true,
                    labelString: 'Relative Humidity (%)'
                  },
                }]
              }
            }
          };

          const windSpeedConfig = {
            type: 'line',
            data: {
              labels: pearlDateTime,
              datasets: [{
                label: 'Wind Speed',
                backgroundColor: 'rgb(51, 146, 116)',
                borderColor: 'rgb(51, 146, 116)',
                data: pearlData.windSpeedMS,
                fill: false,
                pointRadius: 0,
              }]
            },
            options: {
              responsive: true,
              title: {
                display: true,
                text: 'Deep Pond Wind Speed',
              },
              tooltips: {
                mode: 'index',
                intersect: false,
              },
              hover: {
                mode: 'nearest',
                intersect: true,
              },
              scales: {
                xAxes: [{
                  display: true,
                  scaleLabel: {
                    display: true,
                    labelString: 'Time'
                  },
                  ticks: {
                    autoSkipPadding: 100,
                    autoSkip: true,
                    minRotation: 0,
                    maxRotation: 0,
                    callback: function(value, index, values) {
                      return value.split(" ")[0];
                    }
                  },
                }],
                yAxes: [{
                  display: true,
                  scaleLabel: {
                    display: true,
                    labelString: 'Wind Speed (m/s)'
                  },
                }]
              }
            }
          };

          const tempEl = document.getElementById('temperature');
          tempEl.height = 200;
          window.temperatureLine = new Chart(tempEl.getContext('2d'), temperatureConfig);

          const humidEl = document.getElementById('humidity');
          humidEl.height = 200;
          window.humidityLine = new Chart(humidEl.getContext('2d'), humidityConfig);

          const windSpeedEl = document.getElementById('windSpeed');
          windSpeedEl.height = 200;
          window.windSpeedLine = new Chart(windSpeedEl.getContext('2d'), windSpeedConfig);
        } else {
          alert("HTTP-Error: " + response.status);
        }
      }

      window.onload = function() {
        run();
      };
    </script>
  </body>
</html>
