<!DOCTYPE html>
<html>
  <head>
    <title>Line Chart</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3"></script>
    <style>
    canvas{
      -moz-user-select: none;
      -webkit-user-select: none;
      -ms-user-select: none;
    }
    </style>
  </head>

  <body>
    <h1>PEARL Environmental Data</h1>

    <div style="width:75%;">
      <canvas id="canvas"></canvas>
    </div>

    <script>
      
      async function run() {
        let response = await fetch("https://s3.amazonaws.com/followpearl.mit.edu/out.json");
        if (response.ok) {
          let json = await response.json();
          console.log(json);
          const pearlDate = json.date;
          const pearlTime = json.time;
          const pearlBmpTempC = json.bmpTempC;
          const pearlLpsTempC = json.lpsTempC;
          const pearlShtTempC = json.shtTempC;
          const pearlShtHumidPercent = json.shtHumidPercent;
          const pearlWindSpeedMS = json.windSpeedMS;
          const pearlDs18TempC = json.ds18TempC;

          const pearlDateTime = pearlDate.map(function(e, i) {
            return `${e} ${pearlTime[i]}`;
          });

          const config = {
            type: 'line',
            data: {
              labels: pearlDateTime,
              datasets: [{
                label: 'LPS',
                backgroundColor: 'rgb(255, 99, 132)',
                borderColor: 'rgb(255, 99, 132)',
                data: pearlLpsTempC,
                fill: false,
              }, {
                label: 'SHT',
                fill: false,
                backgroundColor: 'rgb(54, 162, 235)',
                borderColor: 'rgb(54, 162, 235)',
                data: pearlShtTempC,
              }]
            },
            options: {
              responsive: true,
              title: {
                display: true,
                text: 'Deep Pond Air Temperature'
              },
              tooltips: {
                mode: 'index',
                intersect: false,
              },
              hover: {
                mode: 'nearest',
                intersect: true
              },
              scales: {
                xAxes: [{
                  display: true,
                  scaleLabel: {
                    display: true,
                    labelString: 'Time'
                  }
                }],
                yAxes: [{
                  display: true,
                  scaleLabel: {
                    display: true,
                    labelString: 'Air Temp (deg C)'
                  }
                }]
              }
            }
          };

          var ctx = document.getElementById('canvas').getContext('2d');
          window.myLine = new Chart(ctx, config);
        } else {
          alert("HTTP-Error: " + response.status);
        }
      }

      window.onload = function() {
        run();
      };

      // window.onload = function() {
      //   var ctx = document.getElementById('canvas').getContext('2d');
      //   window.myLine = new Chart(ctx, config);
      // };
    </script>
  </body>
</html>
